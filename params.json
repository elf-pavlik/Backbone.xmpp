{"google":"","tagline":"A simple module to replace Backbone.sync with XMPP PubSub-based persistence.","body":"# Backbone XMPP Pub-Sub Storage\r\n\r\nAn alternative storage layer for syncing Backbone models/collection with XMPP Pub-Sub nodes\r\n\r\n## Introduction\r\n\r\n[Backbone] makes it easy to support alternative storage layers to its default RESTful JSON requests.\r\nThis package provides such a layer on top of [XMPP Publish-Subscribe][XEP-0060] through mapping `Backbone.Collection` instances to Pub-Sub nodes and their `Backbone.Model` instances to items of the node. In addition, it provides support for handling real-time XMPP notifications on these nodes, pushing live updates to the collections/models.\r\n\r\n## Usage\r\n\r\nIn order for a collection to use the storage, override its `sync()` function and provide an instance of `PubSubStorage` on the `node` attribute of the collection, for instance:\r\n\r\n```javascript\r\nvar MyCollection = Backbone.Collection.extend({\r\n    sync: Backbone.xmppSync,\r\n    model: MyModel,\r\n    ...\r\n});\r\n\r\nvar mycollection = new MyCollection();\r\nmycollection.node = new PubSubStorage('mymodels', connection);\r\n```\r\n\r\nwhere the arguments `'mymodels'`, and `connection` are the node id on your XMPP PubSub server, and Strophe's connection object, respectively.\r\n\r\nFor models, it is not necessary to specify the node (though you can, on the rare occasion where you sync a model *without* a collection), i.e. the following is sufficient:\r\n\r\n```javascript\r\nvar MyModel = Backbone.Model.extend({\r\n    sync: Backbone.xmppSync,\r\n    ...\r\n});\r\n\r\nvar mymodel = new MyModel();\r\nmycollection.add(mymodel);\r\n```\r\n\r\nThat's it! Note that the storage will not take care of creating, configuring the node or managing subscriptions. This should be typically done on the server. However, if you wish to do so client-side, you can by means of utilising the bundled [PubSub plugin](http://ggozad.github.com/strophe.plugins) for [Strophe].\r\n\r\n## Notifications\r\n\r\nIf your XMPP server is configured to support PEP-notifications and the user connected is subscribed to the node, you can push real-time updates to your models/collections.\r\n\r\nEvents are fired by the PubSub Strophe plugin, and you can bind to these in your collections. For example, in the `initialize()` of your collection's view, you can do\r\n\r\n```javascript\r\nconnection.PubSub.on(\r\n    'xmpp:pubsub:item-published:mymodels',\r\n    this.itemPublished, this);\r\n```\r\n\r\nin order to bind the `xmpp:pubsub:item-published` event of the `mycollection` node to the `itemPublished` function.\r\n\r\nThere are four relevant events fired by the `PubSub` module:\r\n\r\n* `xmpp:pubsub:item-published` will fire whenever an item is added or updated on a PubSub node. The handler will receive an object with the folliwing attributes:`node` (the id of the node), `id` (the id of the item) and `entry` (the entry containing the XML payload). Bind to this event if you want a central delegation of PubSub events.\r\n* `xmpp:pubsub:item-published:*node_id*` is the same as `xmpp:pubsub:item-published` except it fires for items of a specific node only. The parameters it passes to the handler are also the same, omitting of course `node`.\r\n* `xmpp:pubsub:item-deleted` will fire whenever an item is deleted from a PubSub node. Parameters passed are `node` and `id`.\r\n* `xmpp:pubsub:item-deleted:*node_id*` same as above, but will only fire if the item belongs to the node with id `*node_id*`.\r\n\r\n## Base collection/model\r\n\r\nBase collection/models using the Pub-Sub storage are provided in `backbone.xmpp.node.js`, namely `PubSubNode` (the collection) and `PubSubItem` (the model). These will automatically subscribe to the add/update/delete XMPP events and will trigger the `add`, `change`, `remove` Backbone events, respectively. You can directly extend from them:\r\n\r\n```javascript\r\nvar MyModel = PubSubItem.extend({\r\n    ...\r\n});\r\n\r\nvar MyCollection = PubSubNode.extend({\r\n    model: MyModel,\r\n    ...\r\n});\r\n\r\nvar mycollection = new MyCollection([], {id: 'mymodels', connection: connection});\r\n```\r\n\r\nPassing `options` to initialize with `id` and `connection` will initialize the `node` as well as setup event handling. You can also specify the node later, or even change it by calling `setNode`, i.e. `mycollection.setNode('mymodels', connection);`.\r\n\r\n## Partial fetching with RSM\r\n\r\nIf your server supports [Result Set Management](http://xmpp.org/extensions/xep-0059.html) with PubSub you can do partial incremental fetches, which is useful if you do not want to fetch the entire node. For example,\r\n\r\n```javascript\r\nvar last, p = mycollection.fetch({rsm: {max: 50}});\r\np.done(function (data, rsm) {\r\n    last = rsm.last;\r\n});\r\n...\r\n// Later do\r\nmycollection.fetch({rsm: {after: last, max: 50}});\r\n\r\n```\r\n\r\nwill fetch the first 50 items initially and save the `rsm` object literal to `last`. Later it will retrieve another 50 items starting from after `last`.\r\n\r\n\r\n## API documentation\r\n\r\nPlease refer to the annotated source:\r\n\r\n* [backbone.xmpp.storage.js](http://ggozad.github.com/Backbone.xmpp/docs/backbone.xmpp.storage.html)\r\n* [backbone.xmpp.node.js](http://ggozad.github.com/Backbone.xmpp/docs/backbone.xmpp.node.html)\r\n* [strophe.pubsub.js](http://ggozad.github.com/strophe.plugins/docs/strophe.pubsub.html)\r\n* [strophe.forms.js](http://ggozad.github.com/strophe.plugins/docs/strophe.forms.html)\r\n\r\n## Demo\r\n\r\nYou can watch Backbone.xmpp in action [here](http://ggozad.com/blog/2012/05/03/a-pub-sub-storage-for-backbone-using-xmpp/).\r\n\r\n## License\r\n\r\nBackbone.xmpp.storage is Copyright (C) 2012 Yiorgis Gozadinos.\r\nIt is distributed under the MIT license.\r\n\r\n[Backbone]: http://documentcloud.github.com/backbone\r\n[XEP-0060]: http://xmpp.org/extensions/xep-0060.html\r\n[Strophe]: http://strophe.im/strophejs","note":"Don't delete this file! It's used internally to help with page regeneration.","name":"Backbone.xmpp"}